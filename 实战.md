# SQLAlchemy实战

---

## 设计我们的数据库 {#articleHeader1}

我们这边的数据库设计是为了上面讲的WSGI对应起来的，毕竟这个是两个最重要的部分。在开发数据库应用前，需要先定义好数据模型。因为本文只是要演示SQLAlchemy的应用，所以我们定义个最简单的数据模型。user表的定义如下：

* id: 主键，一般由数据库的自增类型实现。

* user\_id: user id，是一个UUID字符串，是OpenStack中最常用来标记资源的方式，全局唯一，并且为该字段建立索引。

* name: user的名称，允许修改，全局唯一，不能为空。

* email: user的email，允许修改，可以为空。

## 搭建数据库层的代码框架 {#articleHeader2}

OpenStack项目中我见过两种数据库的代码框架分隔，一种是Keystone的风格，它把一组API的API代码和数据库代码都放在同一个目录下，如下所示：

由于webdemo采用的是Pecan框架，而且把数据库操作的代码放到同一个目录下也会比较清晰，所以我们采用和Magnum项目相同的方式来编写数据库相关的代码，创建webdemo/db目录，然后把数据库操作的相关代码都放在这个目录下，如下所示：

由于webdemo项目还没有使用oslo\_db库，所以代码看起来比较直观，没有Magnum项目复杂。接下来，我们就要开始写数据库操作的相关代码，分为两个步骤：

1. 在_db/models.py_中定义`User`类，对应数据库的user表。

2. 在_db/api.py_中实现一个`Connection`类，这个类封装了所有的数据库操作接口。我们会在这个类中实现对user表的CRUD等操作。

### 定义User数据模型映射类 {#articleHeader3}



## 小结 {#articleHeader6}

现在我们已经完成了数据库层的代码框架搭建，读者可以大概了解到一个OpenStack项目中是如何进行数据库操作的。上面的代码可以到[https://github.com/diabloneo/webdemo](https://github.com/diabloneo/webdemo)下载。数据库层的代码框架搭建，读者可以大概了解到一个OpenStack项目中是如何进行数据库操作的。上面的代码可以到[https://github.com/diabloneo/webdemo](https://github.com/diabloneo/webdemo)下载。

